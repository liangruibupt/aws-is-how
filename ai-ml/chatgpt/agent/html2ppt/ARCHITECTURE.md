# HTML2PPT 架构设计文档

## 项目概述

HTML2PPT是一个智能的HTML文档转PowerPoint演示文稿的工具，通过语义分析和样式映射，能够保持原始HTML的内容结构和视觉样式，生成高质量的PPT文档。

## 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    HTML2PPT 系统架构                        │
├─────────────────────────────────────────────────────────────┤
│  输入层 (Input Layer)                                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ HTML 文件   │  │ 配置文件    │  │ PPT 模版    │         │
│  │ (.html)     │  │ (.yaml)     │  │ (.pptx)     │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
├─────────────────────────────────────────────────────────────┤
│  解析层 (Parsing Layer)                                     │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              HTML Parser                                │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │ 结构解析    │  │ 样式提取    │  │ 内容提取    │     │ │
│  │  │ (Structure) │  │ (Styles)    │  │ (Content)   │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  分析层 (Analysis Layer)                                    │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │            Semantic Analyzer                            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │ 语义分析    │  │ 重要性评估  │  │ 结构优化    │     │ │
│  │  │ (Semantic)  │  │ (Importance)│  │ (Structure) │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  映射层 (Mapping Layer)                                     │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  Style Mapper          Template Manager                 │ │
│  │  ┌─────────────┐       ┌─────────────┐                 │ │
│  │  │ 样式映射    │       │ 模版管理    │                 │ │
│  │  │ (CSS->PPT)  │       │ (Templates) │                 │ │
│  │  └─────────────┘       └─────────────┘                 │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  生成层 (Generation Layer)                                  │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                PPT Generator                            │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │ 幻灯片生成  │  │ 内容布局    │  │ 样式应用    │     │ │
│  │  │ (Slides)    │  │ (Layout)    │  │ (Styling)   │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  输出层 (Output Layer)                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ PPT 文件    │  │ 统计信息    │  │ 日志文件    │         │
│  │ (.pptx)     │  │ (Stats)     │  │ (.log)      │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

## 核心模块设计

### 1. HTML Parser (html_parser.py)

**职责**: 解析HTML文档，提取结构化内容和样式信息

**主要功能**:
- HTML文档结构解析
- CSS样式提取和解析
- 图片资源处理
- 表格和列表结构识别
- 文本内容提取和格式化

**输入**: HTML文件、配置参数
**输出**: 结构化的内容数据

```python
{
    'document_info': {...},
    'sections': [...],
    'images': [...],
    'styles': {...}
}
```

### 2. Semantic Analyzer (semantic_analyzer.py)

**职责**: 分析内容语义，评估重要性，优化PPT结构

**主要功能**:
- 内容语义分析
- 重要性分数计算
- 关键点提取
- PPT结构建议
- 布局推荐

**输入**: 解析后的HTML内容
**输出**: 语义分析结果和PPT结构建议

### 3. Style Mapper (style_mapper.py)

**职责**: 将HTML样式映射到PowerPoint样式

**主要功能**:
- CSS到PPT样式转换
- 字体映射
- 颜色转换
- 布局样式适配

**样式映射规则**:
```
HTML CSS          →    PowerPoint
font-family       →    Font.name
font-size         →    Font.size
color             →    Font.color.rgb
font-weight       →    Font.bold
text-align        →    Paragraph.alignment
```

### 4. Template Manager (template_manager.py)

**职责**: 管理PowerPoint模版

**主要功能**:
- 模版加载和验证
- 布局选择
- 自定义模版创建
- 模版备份和恢复

### 5. PPT Generator (ppt_generator.py)

**职责**: 生成最终的PowerPoint文档

**主要功能**:
- 幻灯片创建
- 内容布局
- 样式应用
- 图片插入
- 表格生成
- 备注添加

## 数据流程

### 处理流程图

```
HTML文件 → HTML Parser → 结构化数据
    ↓
配置文件 → Semantic Analyzer → 语义分析结果
    ↓
PPT模版 → Style Mapper → 样式映射
    ↓
Template Manager → PPT Generator → PowerPoint文件
```

### 详细数据流

1. **输入阶段**
   - 读取HTML文件内容
   - 加载配置文件
   - 验证PPT模版

2. **解析阶段**
   - 解析HTML DOM结构
   - 提取CSS样式信息
   - 识别内容类型（文本、图片、表格等）
   - 处理图片资源

3. **分析阶段**
   - 分析内容语义
   - 计算重要性分数
   - 提取关键信息
   - 生成PPT结构建议

4. **映射阶段**
   - 转换CSS样式到PPT格式
   - 选择合适的幻灯片布局
   - 应用模版设置

5. **生成阶段**
   - 创建幻灯片
   - 添加内容和样式
   - 插入图片和表格
   - 生成备注信息

6. **输出阶段**
   - 保存PowerPoint文件
   - 生成统计报告
   - 记录处理日志

## 配置系统

### 配置文件结构

```yaml
semantic_analysis:      # 语义分析配置
  enabled: true
  model: "local"
  content_weights: {...}

style_mapping:          # 样式映射配置
  tag_mapping: {...}
  font_mapping: {...}
  color_mapping: {...}

layout_settings:        # 布局设置
  slide_width: 10
  slide_height: 7.5
  margins: {...}

image_processing:       # 图片处理配置
  download_external: true
  max_size_mb: 10
  supported_formats: [...]

ppt_generation:         # PPT生成配置
  default_template: "..."
  slide_types: {...}
  notes: {...}
```

## 扩展性设计

### 插件架构

系统设计支持插件扩展：

1. **解析器插件**: 支持其他格式输入（Markdown、Word等）
2. **分析器插件**: 支持不同的语义分析模型
3. **样式插件**: 支持自定义样式映射规则
4. **输出插件**: 支持其他格式输出（PDF、HTML等）

### 接口设计

```python
class BaseParser:
    def parse(self, content): pass

class BaseAnalyzer:
    def analyze(self, content): pass

class BaseGenerator:
    def generate(self, content, output_path): pass
```

## 性能优化

### 内存管理
- 流式处理大文件
- 及时释放不需要的对象
- 图片压缩和缓存

### 处理速度
- 并行处理独立任务
- 缓存重复计算结果
- 优化算法复杂度

### 资源使用
- 可配置的资源限制
- 智能的内容分块
- 渐进式处理

## 错误处理

### 异常分类
1. **输入错误**: 文件不存在、格式错误
2. **解析错误**: HTML格式问题、CSS解析失败
3. **生成错误**: 模版问题、权限不足
4. **系统错误**: 内存不足、磁盘空间不够

### 容错机制
- 优雅降级处理
- 部分失败继续处理
- 详细的错误日志
- 用户友好的错误提示

## 测试策略

### 单元测试
- 每个模块独立测试
- 边界条件测试
- 异常情况测试

### 集成测试
- 模块间协作测试
- 端到端流程测试
- 性能基准测试

### 测试数据
- 多种HTML格式样本
- 不同复杂度的文档
- 边界情况测试用例

## 部署和维护

### 部署方式
1. **本地安装**: pip安装包
2. **Docker容器**: 容器化部署
3. **云服务**: 作为Web服务部署

### 监控和日志
- 处理性能监控
- 错误率统计
- 用户使用分析
- 详细的操作日志

### 版本管理
- 语义化版本号
- 向后兼容性保证
- 升级路径规划

## 未来发展

### 功能扩展
1. **多语言支持**: 国际化和本地化
2. **实时预览**: Web界面实时预览
3. **批量处理**: 支持批量文件转换
4. **云端服务**: 提供API服务

### 技术升级
1. **AI增强**: 更智能的语义分析
2. **性能优化**: 更快的处理速度
3. **格式支持**: 支持更多输入输出格式
4. **用户体验**: 更友好的界面和交互

这个架构设计确保了系统的可扩展性、可维护性和高性能，为未来的功能扩展和技术升级提供了良好的基础。